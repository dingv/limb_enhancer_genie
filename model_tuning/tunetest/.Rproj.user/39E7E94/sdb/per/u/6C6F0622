{
    "collab_server" : "",
    "contents" : "load(\"norm_scores_final.Rdata\")\n\nencode_distal_regs<-read.table(\"ENCODE.H3K27ac.distal.mm10.txt\",header=TRUE)\n\nload(\"res_nocons_best_e4.Rdata\")\nload(\"res_nocons_sum_e4.Rdata\")\n\nnorm.scores<-list(res_no.cons_best, res_no.cons_sum)\n\nget.reg<-function(x){\n  seqnames<-str_extract(x, \"chr[0-9]{0,2}[XY]{0,1}\" )\n  ranges<-do.call(\"rbind\", lapply( str_split( str_extract(x, \"[0-9]+-[0-9]+\"), \"-\"), as.numeric))\n  return(GRanges(seqnames = seqnames, ranges = IRanges(start = ranges[,1], end=ranges[,2])))\n}\n\nregions<-lapply(norm.scores, function(x){get.reg(row.names(x))})\n\nhead(encode_distal_regs)\ndistal.regs<-GRanges(seqnames = encode_distal_regs$chrom, ranges = IRanges(encode_distal_regs$start, encode_distal_regs$end) )\nmcols(distal.regs)<-encode_distal_regs[,-(1:3)]\n\nlibrary(GenomicAlignments)\nolaps<-lapply(regions, function(x){ findOverlaps(distal.regs, x, type = \"equal\")})\n\n# none should be equal:\nsapply(olaps, function(x){table(duplicated(queryHits(x)))})\n\n# reordering the data:\nreordered_meta<-lapply(olaps, function(x){ encode_distal_regs[ queryHits(x), -(1:4) ] })\n\nhead(reordered_meta[[1]])\n\ncors.conserved<-lapply(norm.scores[[1]], function(x){ cor(cbind(x,reordered_meta[[1]]), method = \"spearman\")})\ncors.conserved<-do.call(cbind, lapply(cors.conserved, function(x){x[,1]}))\ncors.conserved<-cors.conserved[-1,]\n\nlibrary(RColorBrewer)\nhmcol<-colorRampPalette(rev(brewer.pal(\"RdBu\",n=9)))(100)\nheatmap.2(cors.conserved,trace=\"none\", col=hmcol, margins = c(5,12))\n\nsort( cors.conserved[\"Limb_E11.5\",] )\n\ncors.non.conserved<-sapply(norm.scores[[3]], function(x){ sapply(reordered_meta[[3]], function(y){cor(x,y,method=\"spearman\")}))\ncors.non.conserved<-sapply(norm.scores[[3]], function(x){ sapply(reordered_meta[[3]], function(y){cor(x,y,method=\"spearman\")}))\n\n\ncor(cbind(x,reordered_meta[[3]]), method=\"spearman\")})\n\ncors.non.conserved<-cor(cbind(norm.scores[[3]],reordered_meta[[3]]), method=\"spearman\")\n\n\ncors.non.conserved<-do.call(cbind, lapply(cors.non.conserved, function(x){x[,1]}))\ncors.non.conserved<-cors.non.conserved[-1,]\n\nlibrary(RColorBrewer)\nhmcol<-colorRampPalette(rev(brewer.pal(\"RdBu\",n=9)))(100)\nheatmap.2(cors.non.conserved,trace=\"none\", col=hmcol, margins = c(5,12))\n\ntmp<-sort(cors.non.conserved[,\"Hoxd13\"])\ntmp[ grep(\"_E11.5\",names(tmp))]\n\ntmp<-sort(cors.non.conserved[,\"Spi1\"])\ntmp[ grep(\"_E11.5\",names(tmp))]\n\nsort( cors.non.conserved[\"Limb_E11.5\",] )\nsort( cors.non.conserved[\"Forebrain_E11.5\",] )\n\n\n\n\n\n\n",
    "created" : 1468016953128.000,
    "dirty" : true,
    "encoding" : "",
    "folds" : "",
    "hash" : "2382480115",
    "id" : "6C6F0622",
    "lastKnownWriteTime" : 5020319744,
    "last_content_update" : 1468020603219,
    "path" : null,
    "project_path" : null,
    "properties" : {
        "tempName" : "Untitled1"
    },
    "relative_order" : 2,
    "source_on_save" : false,
    "source_window" : "",
    "type" : "r_source"
}